# Cowrie-Honeypot-Project


## **1. Introduction**

In the realm of cybersecurity, honeypots serve as critical tools for detecting, analyzing, and understanding malicious activities. This project focuses on deploying **Cowrie**, a high-interaction SSH honeypot, on a **Kali Linux VM** and simulating attack scenarios from a **Windows 11 VM**. The objective is to collect and analyze logs generated by Cowrie to gain insights into attack patterns and methodologies. 

## **2. Objectives**

- **Deploy Cowrie Honeypot:** Install and configure Cowrie on Kali Linux to emulate an SSH server vulnerable to attacks.
- **Simulate Attacks:** Use Windows 11 VM to perform SSH brute-force attacks and exploit attempts against the Cowrie honeypot.
- **Log Collection and Analysis:** Capture and analyze logs from Cowrie to understand attacker behaviors and techniques.
- **Documentation and Reporting:** Compile a comprehensive report detailing the setup, attack simulations, log analysis, and findings.


## **3. Skills Learned**

- **Virtualization Management:** Setting up and configuring virtual machines using VMware Fusion on Mac M1.
- **Honeypot Deployment:** Installing, configuring, and running Cowrie as an SSH/Telnet honeypot.
- **Linux System Administration:** Installing and configuring services on Kali Linux.
- **Network Configuration:** Ensuring seamless communication between virtual machines via internal networking.
- **Attack Simulation:** Utilizing tools like PuTTY, and Metasploit to perform SSH brute-force and exploit attacks.
- **Log Analysis:** Interpreting Cowrie-generated logs and using Wireshark for network traffic analysis.
- **Documentation:** Structuring a detailed project report and maintaining comprehensive documentation.
- **Basic Penetration Testing:** Launching attacks from the Windows 11 VM using tools like Nmap and Metasploit.

## **4. Tools Used**

- **Mac M1:** Host machine running VMware Fusion.
- **VMware Fusion:** Virtualization software for managing virtual machines.
- **Kali Linux VM:** Operating system hosting Cowrie honeypot.
- **Windows 11 VM:** Operating system used to simulate attack vectors.
- **Cowrie:** SSH honeypot for capturing and logging attack attempts.
- **PuTTY:** SSH client for manual connection attempts.
- **Metasploit Framework:** Platform for developing and executing exploit code.
- **Nmap:** Network scanning tool for identifying open ports and services.
- **Wireshark:** Network protocol analyzer for capturing and inspecting network traffic.



## **5. Methodology**

### **5.1. Setting Up the Virtual Environment**

1. **Configuring Networking:**
   - Both Kali Linux and Windows 11 VMs were set to **Host-Only** networking, assigning static IPs (`192.168.56.101` for Kali and `192.168.56.102` for Windows).
   - Verify Connections:
     
     From Kali:
     ```
     ping 192.168.56.102
     ```
    
     From Windows:
     ```
     ping 192.168.56.101
     ```

2. **Installing Dependencies:**
   - On Kali Linux, essential packages and dependencies for Cowrie were installed, including Python 3, Git, and necessary libraries.

     Open the terminal: 

   - Update and Upgrade System:
     ```
     sudo apt update
     sudo apt upgrade -y
     sudo reboot
     ```
    - Install Essential Packages:
      ```
      sudo apt install -y git python3 python3-pip python3-virtualenv 
      sudo apt install -y libssl-dev libffi-dev build-essential python3-dev libpython3-dev authbind
      sudo apt install -y virtualenv
      ```
    - Install Firewall: 
       ```
        sudo apt install -y ufw
        sudo ufw allow 2222/tcp
        sudo ufw enable
       ```
    - Install wireshark:
       ```
         sudo apt install -y wireshark
         sudo dpkg-reconfigure wireshark-common
         sudo usermod -aG wireshark $(whoami)
        ```
    - Create a user in linux:(name:cowrie and we add it to the sudo group)
      ```
      sudo su
      adduser cowrie
      usermod -a -G sudo cowrie
      chsh -s /bin/bash cowrie
      sudo su - cowrie
      ``` 
    - Clone Cowrie Repository:
      ```
      git clone https://github.com/cowrie/cowrie.git
      cd cowrie
      ```
    - Set Up Virtual Environment:
      ```
      python3 -m venv cowrie-env
      source cowrie-env/bin/activate
      ```
    - Install Python Dependencies:
      ```
      pip install --upgrade pip
      pip install -r requirements.txt
      ```
    - Copy Configuration Template and edit:
      ```
      cd etc/
      cp cowrie.cfg.dist cowrie.cfg
      nano cowrie.cfg
      ```
      [ssh]
      - listen_port=2222[choose port number that doesn't conflict with existing services]

      hostname = svr001
      
      [telnet]
      - enabled=true
      
      Save [ Press Ctrl + X, Then Y and Enter ]

    - Start the Cowrie and verify it is running:
      ```
      cd cowrie
      bin/cowrie start
      bin/cowrie status
      ```
    - Ensure port is listening:
      ```
      netstat -tuln | grep 2222
      ```

<img width="1440" alt="Cowrie Status" src="https://github.com/user-attachments/assets/3918e927-da8a-4eba-966a-dd23023330ea">


   - Launch the wireshark and start capturing packets.

### 5.2. Simulating Attacks 

1. **Using Nmap**
   - Install Nmap on Windows
   - Use Nmap to scan open ports
      
      ```
      nmap -p- 192.168.56.101
      ```
<img width="1028" alt="Nmap" src="https://github.com/user-attachments/assets/053f193b-d995-43aa-8f63-c8d1a66fbb6e">



2. **Using Telnet**
  - Open the terminal and try to telnet.
  - Initially, we might need to enable the telnet client. It can be done by Control panel>Programs>Programs and Features>Turn windows Features On or Off>Telnet client:âœ”

<img width="1149" alt="Telnet enable" src="https://github.com/user-attachments/assets/1aee6af7-78ae-4e34-ae2e-90888ad3da4e">

  - Then we will try to telnet the kali machine. Once, it is successful, we dive deeper.
<img width="1153" alt="Telnet-1" src="https://github.com/user-attachments/assets/61f3266d-81a0-4071-8904-4a72be7ac416">
<img width="1152" alt="Telnet-2" src="https://github.com/user-attachments/assets/fdce8881-73d5-411a-b874-d6e74e360924">

3. **Using Using PuTTY to SSH into Cowrie**
  - Download and install PuTTY on windows 11.
  - Open PuTTY and enter the Kali Linux IP address and SSH port configured in Cowrie i.e 2222

<img width="1151" alt="Putty-1" src="https://github.com/user-attachments/assets/277a50e9-7973-4bd9-b064-c7b71d32d811">
<img width="1154" alt="Putty-2" src="https://github.com/user-attachments/assets/cd112470-2f9e-432f-a2e9-f8cc9b0a25b3">
<img width="1157" alt="Putty-3" src="https://github.com/user-attachments/assets/29936678-189a-4f8b-a035-559f3a376487">


### 5.3. Log Collection and Analysis
  1. **Accessing Logs:**
   - Locate Cowrie logs:Cowrie logs everything, including login attempts, shell activity, and file downloads.
     ```
     cd var/log/cowrie
     ```
     - cowrie.json contains detailed logs of sessions, commands, etc.
     - cowrie.log contains a more readable format of login attempts and basic interactions

   - View Cowrie logs: Here, we can see the SSH and telnet activities.

     ```
     tail cowrie.log
     ```
     <img width="1440" alt="Cowrie logs 1" src="https://github.com/user-attachments/assets/e17b26a0-6a0e-4542-88da-2fd3bd321ac7">
     
     ```
     cat cowrie.json
     ```
      <img width="1339" alt="Cowrie logs 2" src="https://github.com/user-attachments/assets/1a198dc8-a44a-4705-a669-21f6f60b0c3e">


  2. **Network Traffic Analysis:** 
      - Stop the capture in wireshark.
      - Set up a filter for telnet traffic: tcp.port == 2223
      - Set up a filter for ssh traffic: tcp.port == 2222
      - Click on any packet to view its details.
      - The Packet Details pane will display a breakdown of the protocol layers such as Ethernet, IP, and TCP.
      - To analyze an entire SSH/Telnet session, right-click on one of the packets related to your SSH/Telnet connection.
      - Select Follow > TCP Stream.
      - Wireshark will display the entire communication between the client (Windows) and the server (Kali Linux), including SSH/Telnet login attempts and any commands issued within the session.
      <img width="1440" alt="Wireshark Telnet 1" src="https://github.com/user-attachments/assets/1074c58f-2b74-4373-887b-27de00039eaf">
      <img width="1440" alt="Wireshark Telnet 2" src="https://github.com/user-attachments/assets/683f372c-6634-4903-beb7-f664cf09f35d">
      <img width="1440" alt="Wireshark SSH 1" src="https://github.com/user-attachments/assets/f9e4bdcc-3fdb-4b80-bb12-319ee1836323">


### 5.4. Attack using Metasploit
   1. **Installing Metasploit:**
      - Kali
        ```
        sudo apt install -y metasploit-framework
        ```
       - Windows:
         
         [Visit this link: ](https://docs.metasploit.com/docs/development/maintainers/downloads-by-version.html)
         Disable Firewall, Virus and threat detection. Download and install.

  2. **Start Cowrie:**
     
       ```
       bin/cowrie start
       ```
     
  4. **Start a Brute-Force Attack Using Metasploit:**
        -  Open the Metasploit console on Windows 11
        -  Select the SSH brute-force module:
          
          
           ```
           use auxiliary/scanner/ssh/ssh_login
           ```
       
      -  Set the ip address, port, username, password:
          
         ```
         set RHOSTS 192.168.56.101
         set RPORT 2222
         set USERNAME root
         set PASS_FILE /path/to/password_list.txt
         set THREADS 5
         run
         ```
      
   <img width="1152" alt="Metasplot Bruteforce1" src="https://github.com/user-attachments/assets/05b1a38c-b4a1-4a2e-a78c-eddf071c78fe">
   

**Monitor Cowrie Honeypot for Attack Logs:**

  While the attack is running, monitor Cowrie  and wireshark on your Kali Linux VM to see how the honeypot reacts to the brute-force attempts.

    
```
    tail cowrie.log
    
    tail cowrie.json
```
      
    
  <img width="1440" alt="Metasploit Bruteforce2" src="https://github.com/user-attachments/assets/c79bfa71-0482-4f0e-822a-4709f3da9e5b">
  <img width="1440" alt="Metasploit Brutforce 3" src="https://github.com/user-attachments/assets/0b3bfbaa-7014-4438-8e8c-77040eb2c66f">

 4. **SSH Version Scanning:**
    - Use the SSH version scanner module
      
      ```
      search ssh
      ``` 
    - Use the SSH version scanner module
      ```
      use auxiliary/scanner/ssh/ssh_version
      ```
    - Set the ip address and port
      ```
      set RHOSTS 192.168.56.101
      set RPORT 2222
      run
      ```
      This will retrieve the SSH banner from Cowrie, which typically includes information about the SSH version.(SSH-2.0-OpenSSH_6.0p1 Debian-4+deb7u2)
      
      <img width="1154" alt="Metasploit SSH version scan1" src="https://github.com/user-attachments/assets/88584c78-1246-4767-8eb3-035720579163">
      <img width="1440" alt="Metasploit SSH version scan2" src="https://github.com/user-attachments/assets/1ec03323-9f9e-460c-ab5e-c444d7212344">


      Additionally, we can take note of the version number returned by the SSH version scan (OpenSSH 6.0p1) and use the Metasploit search command to look for exploits that target that       version:

      ```
      search openssh
      ```
      <img width="1156" alt="Metasploit SSH version scan3" src="https://github.com/user-attachments/assets/15108061-778d-4079-a768-790e59d7b823">


          
## **6. Conclusion**

This project successfully demonstrated the deployment and utilization of **Cowrie Honeypot** within a virtualized environment to monitor and analyze malicious SSH activities. By simulating both manual and automated attack vectors from a Windows 11 VM, the effectiveness of Cowrie in capturing and logging such attempts was validated. The integration of **Wireshark** provided additional insights into the network traffic patterns associated with these attacks.

Through this exercise, essential skills in **honeypot deployment**, **attack simulation**,and **log analysis** were honed. The structured approachâ€”from setting up the environment to executing attacks and analyzing resultsâ€”underscored the importance of meticulous planning and execution in cybersecurity projects.

Moving forward, further enhancements could include integrating more sophisticated attack vectors, implementing advanced log analysis techniques, and expanding the honeypot's capabilities to emulate additional services beyond SSH.

---


## **Additional Resources**

- **Cowrie Documentation:** [https://cowrie.readthedocs.io/en/latest/](https://cowrie.readthedocs.io/en/latest/)
- **Wireshark Official Site:** [https://www.wireshark.org/](https://www.wireshark.org/)
- **Metasploit Framework Documentation:** [https://docs.metasploit.com/](https://docs.metasploit.com/)
- **GitHub Guides:** [https://guides.github.com/](https://guides.github.com/)
- **PowerShell Scripting Basics:** [https://docs.microsoft.com/en-us/powershell/scripting/overview](https://docs.microsoft.com/en-us/powershell/scripting/overview)

---



